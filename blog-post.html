<!-- blog-post.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Post - Brian Kibet</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://kit.fontawesome.com/56bf1872c9.js" crossorigin="anonymous"></script>
</head>

<body>

    <!-- 5. To add a new blog post:

Open the posts.json file
Add a new entry to the "posts" array with:

A unique ID
Title
Date
Excerpt (short summary)
Content (full HTML content of your post)



 -->
    <!-- --------------------Nav Bar ------------------------------------>

    <div id="header">
        <nav>
            <img src="/public/assets/images/profile_logo.jpeg" class="logo">
            <ul id="sidemenu">
                <li><a href="/index.html#header">Home</a></li>
                <li><a href="/index.html#about">About</a></li>
                <li><a href="/index.html#services">Services</a></li>
                <li><a href="/index.html#my work">My Work</a></li>
                <li><a href="/blog.html#blog">Blog</a></li>

                <i class="fas fa-times close-icon" onclick="closemenu()"></i>
            </ul>
            <i class="fas fa-bars" onclick="openmenu()"></i>
        </nav>
    </div>

    <!-- Blog Post Content -->
    <div id="blog">
        <div class="container">
            <div id="blog-content">
                <!-- Blog post content will be loaded here dynamically -->
                <div class="loading">Loading blog post...</div>
            </div>

            <a href="blog.html" class="back-to-blog">&larr; Back to Blog</a>
        </div>
    </div>

    <footer>
        <div id="copyright">
            <div class="copyright">
                <p style="text-align: center;">Copyright &copy;
                    <script>document.write(new Date().getFullYear())</script> Brian Kibet. All Rights Reserved
                </p>
            </div>
        </div>
    </footer>

    
    <script>
    function openmenu() {
        document.getElementById("sidemenu").style.right = "0";
        document.body.style.overflow = "hidden";
    }

    function closemenu() {
        const menuWidth = window.innerWidth <= 380 ? "-180px" : "-250px";
        document.getElementById("sidemenu").style.right = menuWidth;
        document.body.style.overflow = "auto";
    }

    document.addEventListener("DOMContentLoaded", function () {
        const menuItems = document.querySelectorAll("#sidemenu li a");
        menuItems.forEach(item => {
            item.addEventListener("click", closemenu);
        });
        document.querySelector(".fas.fa-bars").addEventListener("click", openmenu);
        document.querySelector(".fas.fa-times").addEventListener("click", closemenu);
        window.addEventListener("resize", function () {
            if (window.innerWidth > 768) {
                closemenu();
            }
        });
        loadBlogPost();
    });

    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        const results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    function loadBlogPost() {
        const postId = getUrlParameter('id');
        console.group('Loading Blog Post');
        console.time('Fetch Duration');

        if (!postId) {
            console.warn('No post ID in URL parameters');
            document.getElementById('blog-content').innerHTML = `
                <h1 class="ctitle">Post Not Found</h1>
                <p>The blog post you're looking for could not be found.</p>
            `;
            console.groupEnd();
            return;
        }

        fetch('./public/blog-posts/posts.json', { signal: AbortSignal.timeout(5000) })
            .then(response => {
                console.log('Fetch Response Status:', response.status);
                console.log('Response OK:', response.ok);
                console.log('Response Headers:', Object.fromEntries(response.headers));
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status} - ${response.statusText}`);
                }
                return response.text();
            })
            .then(text => {
                console.log('Raw Response Text Length:', text.length);
                console.log('First 200 Characters:', text.substring(0, 200));
                try {
                    const data = JSON.parse(text);
                    console.log('JSON Parsed Successfully');
                    console.log('Data Structure:', Object.keys(data));
                    console.log('Posts Array Length:', data.posts ? data.posts.length : 'No posts property');
                    const post = data.posts.find(p => p.id === postId);
                    if (post) {
                        displayBlogPost(post);
                    } else {
                        console.warn(`Post with ID '${postId}' not found in data`);
                        document.getElementById('blog-content').innerHTML = `
                            <h1 class="ctitle">Post Not Found</h1>
                            <p>The blog post you're looking for could not be found.</p>
                        `;
                    }
                } catch (parseError) {
                    console.error('JSON Parse Error:', parseError.message);
                    console.error('Error Position:', parseError.message.match(/position (\d+)/)?.[1]);
                    console.error('Context Around Error:', text.substring(Math.max(0, parseError.position - 20), parseError.position + 20));
                    throw parseError;
                }
            })
            .catch(error => {
                console.error('Fetch or Processing Error:', error.message);
                if (error.name === 'AbortError') {
                    console.warn('Fetch aborted due to timeout (5 seconds)');
                } else if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    console.warn('Network error or CORS issue detected');
                }
                document.getElementById('blog-content').innerHTML = '<p>Failed to load blog post. Check your internet connection or try again later. See console for details.</p>';
            })
            .finally(() => {
                console.timeEnd('Fetch Duration');
                console.groupEnd();
            });
    }

    function displayBlogPost(post) {
        document.title = `${post.title} - Brian Kibet`;
        const postDate = new Date(post.date).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        const blogContentElement = document.getElementById('blog-content');
        blogContentElement.innerHTML = `
            <div class="blog-header">
                <div class="blog-date">${postDate}</div>
                <h1 class="ctitle">${post.title}</h1>
            </div>
            <div class="blog-content">
                ${post.content}
            </div>
        `;
        if (window.hljs) {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        }
    }
</script>




</body>

</html>